<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr">

<head>
<title>Du Makefile au Rakefile</title>
<!-- metadata -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.2a2" />
<meta name="presdate" content="20090211" />
<meta name="author" content="Farzad FARID" />
<meta name="company" content="Pragmatic Source" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/default/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/default/opera.css" type="text/css" media="projection" id="operaFix" />
<!-- embedded styles -->
<style type="text/css" media="all">
  .imgcon {width: 525px; margin: 0 auto; padding: 0; text-align: center;}
  #anim {width: 270px; height: 320px; position: relative; margin-top: 0.5em;}
  #anim img {position: absolute; top: 42px; left: 24px;}
  img#me01 {top: 0; left: 0;}
  img#me02 {left: 23px;}
  img#me04 {top: 44px;}
  img#me05 {top: 43px;left: 36px;}
</style>
<!-- S5 JS -->
<script src="lib/MochiKit.js" type="text/javascript"></script>
<script src="ui/default/slides.js" type="text/javascript"></script>
<!-- SHJS Syntax Highlighter -->
<script type="text/javascript" src="lib/shjs/sh_main.js"></script>
<link type="text/css" rel="stylesheet" href="ui/shjs/sh_style.css">
</head>
<body onload="sh_highlightDocument('lib/shjs/', '.js');">

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h1>Apéro Ruby &#8226; 11 février 2009</h1>
<h2>Du Makefile au Rakefile</h2>
</div>
</div>

<ol class="xoxo presentation">

<li class="slide">
<h1>Du Makefile au Rakefile</h1>
<h2>Utilisation de Ruby pour des tâches d'administration système</h2>
<h3>Farzad Farid</h3>
<h4><a href="http://www.pragmatic-source.com/" rel ="external">Pragmatic Source</a></h4>
<div class="handout">
[any material that should appear in print but not on the slide]
</div>
</li>

<li class="slide">
    <h1>Qui suis-je ?</h1>
    <p class="citation">«The human brain starts working the moment you are born<br />
        and never stops until you stand up to speak in public. »<br />

        Sir George Jessel</p>
    <ul class="incremental show-first">
        <li>Expert Open Source</li>
        <li>Plus système que développement
            <ul class="incremental">
                <li>Ex Python-addict</li>
                <li>Maintenant Ruby fan</li>
            </ul>
        </li>
        <li>Partisan de la simplication et de l'automatisation des tâches d'administration</li>
        <li>Essaie d'appliquer des principes et recettes agiles dans le conseil et l'intégration</li>
    </ul>
</li>

<li class="slide">
    <h1>Présentation du contexte (1)</h1>
    <p>Ce que le client a aujourd'hui :</p>
    <ul class="incremental">
        <li>Serveur de message et annuaire sur base Debian Linux</li>
        <li>Serveur IMAP Cyrus IMAP 2.1.14 (<b>vieux !</b>)</li>
        <li>Annuaire OpenLDAP 2.0.23 (<b>vieux !!</b>)</li>
        <li>Debian 3.1 (<b>antédéluvien..</b>)</li>
    </ul>
</li>

<li class="slide">
<h1>Présentation du contexte (2)</h1>
<p>Extensions sauvages du schéma LDAP</p>
<pre class="sh_diff">
diff -ur schema/core.schema ../../../isis/ldap/schema/core.schema
--- schema/core.schema 2002-02-08 18:38:54.000000000 +0100
+++ ../../../isis/ldap/schema/core.schema 2007-10-15 10:31:04.000000000 +0200
@@ -1,3 +1,6 @@
+# Objectclass 'person' a ete modifier pour prendre en compte l attribut
+# usergroup pour gerer les differents droits d acces a la base ldap sur l 'intra
+#
# $OpenLDAP: pkg/ldap/servers/slapd/schema/core.schema,v 1.7.2.18 2002/02/08 17:38:54 kurt Exp $
#
# OpenLDAP Core schema
@@ -369,7 +379,7 @@
objectclass ( 2.5.6.6 NAME 'person' SUP top STRUCTURAL
MUST ( sn $ cn )
- MAY ( userPassword $ telephoneNumber $ seeAlso $ description ) )
+ MAY ( userPassword $ telephoneNumber $ seeAlso $ description $ intragroup) )
objectclass ( 2.5.6.7 NAME 'organizationalPerson' SUP person STRUCTURAL
MAY ( title $ x121Address $ registeredAddress $ destinationIndicator $</pre>
</li>

<li class="slide">
    <h1>Présentation du contexte (3)</h1>
    <p>Ce que le client veut :</p>
    <ul class="incremental">
        <li>Serveur Debian Linux 4.0 (<b>bon ok, déjà un peu vieux...</b>)</li>
        <li>Serveur IMAP Cyrus IMAP 2.2.13</li>
        <li>Annuaire OpenLDAP 2.3.30</li>
    </ul>
</li>

<li class="slide">
<h1>Problèmes</h1>
<ul class="incremental">
<li>Il faut réinstaller un serveur complet, avec LDAP, SMTP et IMAP
  <ul class="incremental">
    <li>OK, facile</li>
  </ul>
</li>
<li>Il faut refaire le schéma LDAP
  <ul class="incremental">
    <li>OK, facile</li>
  </ul>
</li>
<li>Il faut transférer toutes les boîtes mail
  <ul class="incremental">
    <li>Hum.. OK, pas trop difficile</li>
  </ul>
</li>
<li>Il faut convertir et standardiser tout le contenu de l'annuaire
  <ul class="incremental">
    <li><b>ARGH !!</b></li>
  </ul>
</li>
<li>=&gt; Il va falloir écrire un logiciel de conversion/nettoyage.</li>
</ul>
</li>

<li class="slide">
<h1>Quel langage utiliser ?</h1>
<p>Solutions possibles :</p>
<ul class="incremental">
<li>Solution 1 : Shell
  <ul>
    <li>Trop de programmes à enchaîner</li>
    <li>Stockage temporaire et traitement des données difficiles</li>
    <li>Il faudra de toute façon écrire des portions dans un langage de plus haut niveau</li>
  </ul>
<li><b>NON</b></li>
</ul>
</li>

<li class="slide">
<h1>Quel langage utiliser ?</h1>
<p>Solutions possibles :</p>
<ul>
<li>Solutions 2
  <ul>
    <li>
    <pre class="sh_perl">
#:: ::-| ::-| .-. :||-:: 0-| .-| ::||-| .:|-. :||
open(Q,$0);while(&lt;Q&gt;){if(/^#(.*)$/){for(split('-',$1)){$q=0;for(split){s/\|
/:.:/xg;s/:/../g;$Q=$_?length:$_;$q+=$q?$Q:$Q*20;}print chr($q);}}}print"\n";
#.: ::||-| .||-| :|||-| ::||-| ||-:: :|||-| .:|
    </pre>
    </li>
  </ul>
</li>
<li class="incremental">Ah, c'est du <b>Perl</b></li>
<li class="incremental"><b>NON</b></li>
<li class="incremental">Mais il y a de bons outils en Perl, qu'on peut utiliser et intégrer dans notre projet</li>
<li class="incremental">=&gt; Pas (trop) d'intégrisme anti-Perl</li>
</ul>
</li>

<li class="slide">
<h1>Quel langage utiliser ?</h1>
<p>Solutions possibles :</p>
<ul>
<li>Solution 3 : Python</li>
<li><pre class="sh_python">
def getldapinfos(ldappointer, file):
                """ get uid and mailhost from ldap then print on stdout uid IN CNAME mailhost """
                """ in case of error for an entry stderr will be used """
                ...
                if I_HAS_PYTHON == True:
                        for entry in resultlist:
                                    for fields in entry:
                                            res = myreg.match(entry[1]["mailHost"][0])
                                            if res != None:
                                                    file.write("%s.imap.mail\tIN\tCNAME\t%s.\n" %( entry[1]["uid"][0], res.group(1)))
                        return 0

</pre>
</li>
<li class="incremental"><b>NON</b></li>
</ul>
</li>


<li class="slide">
<h1>Quel langage utiliser ?</h1>
<p>Solutions possibles :</p>
<ul class="incremental">
<li>Solution 4 : Ruby
  <ul>
    <li>Langage clair, facile à lire ET a écrire</li>
    <li>Orienté Objet, typage dynamique</li>
    <li>Le meilleur de Perl, Python (et un peu Smalltalk) dans un seul langage</li>
  </ul>
</li>
<li><b>OUI !</b></li>
</ul>
</li>

<li class="slide">
<h1>Structure du programme</h1>
<p>Dans la migration, il y a plusieurs tâches, séquentielles ou pas, à enchaîner</p>
<p class="incremental">On veut :</p>
<ul class="incremental">
<li>Avoir des dépendances entre tâches</li>
<li>Pouvoir préciser en ligne de commande une tâche en particulier</li>
<li>Minimiser le nombre de programmes/scripts</li>
<li>Ne pas avoir à coder du <b>getopt</b> ou équivalent</li>
</ul>
<p class="incremental">Pourquoi pas <b>Makefile</b> ?</p>
</li>

<li class="slide">
<h1>Version Makefile</h1>
<pre class="sh_makefile">
INFILE  := customer-orig.ldif
OUTFILE := customer-clean.ldif
CLEANER := ./customer-clean-ldif.rb
ROOTDN  := "cn=admin, o=customer, c=fr"
ROOTPW  := "XXXXX"

clean_ldif:
        ssh old-srv "slapcat" > $(INFILE)
        $(CLEANER) $(INFILE) > $(OUTFILE)

test_ldif: clean_ldif
        ldapadd -n -x -h localhost -D $(ROOTDN) -w $(ROOTPW) -f $(OUTFILE)
#...etc...
</pre>
<ul class="incremental">
  <li>C'est pas mal</li>
  <li>Ca marche plus ou moins, pour les 1ères tâches simple</li>
  <li>Mais on peut mieux faire<li>
</ul>
</li>

<li class="slide">
<h1>Here comes Rake!</h1>
<p>Rake est un logiciel écrit en Ruby, qui permet de décrire et de contrôler des tâches
à la Makefile</p>
<p>Dans un fichier Rakefile on n'écrit que du Ruby</p>
<ul class="incremental">
<li><b>Big love!</b></li>
</ul>
</li>

<li class="slide">
<h1>Version Makefile</h1>
<pre class="sh_makefile">
INFILE  := customer-orig.ldif
OUTFILE := customer-clean.ldif
CLEANER := ./customer-clean-ldif.rb
ROOTDN  := "cn=admin, o=customer, c=fr"
ROOTPW  := "XXXXX"

all:
        @echo "Vous devez specifier la commande a executer"
        exit 1

clean_ldif:
        ssh old-srv "slapcat" > $(INFILE)
        $(CLEANER) $(INFILE) > $(OUTFILE)

test_ldif: clean_ldif
        ldapadd -n -x -h localhost -D $(ROOTDN) -w $(ROOTPW) -f $(OUTFILE)
#...etc...
</pre>
<ul class="incremental">
  <li>C'est pas mal</li>
  <li>Ca marche plus ou moins, pour les 1ères tâches simple</li>
  <li>Mais on peut mieux faire<li>
</ul>
</li>

<li class="slide">
    <h1>Colorisation de code</h1>
    <pre class="sh_ruby">
puts "Envoi en local d'un mail de #{user_from} vers #{users_to}.."
# handling exceptions
begin
 Net::SMTP.start('localhost', 25) do |smtpclient|
   smtpclient.send_message(the_email, user_from, users_to_list)
 end
 puts "Mail envoyé"
rescue Exception =&gt; e
 print "Exception occured: " + e
end </pre>
</li>

<li class="slide">
<h1>What Is S5?</h1>
<ul>
<li>It's a <strong>S</strong>imple <strong>S</strong>tandards-based <strong>S</strong>lide <strong>S</strong>how <strong>S</strong>ystem</li>
<li>One XHTML document provides all of the slide show's content</li>
<li>CSS handles the layout and look of the slides</li>
<li>JavaScript handles the dynamic aspects of the show</li>
<li>That's all there is to it!  (<a href="#slide10">skip to summary</a>; demonstrates links internal to the slide show)</li>
</ul>

<div class="notes">
<ul>
<li>I have notes here!</li>
<li>Keen.</li>
<li>Remember to tell people that notes are a new feature in 1.2</li>
</ul>
</div>

</li>


<li class="slide">
<h1>Operatic Origins</h1>
<ul>
<li>Opera 4 introduced <a href="http://www.opera.com/support/tutorials/operashow/" rel="external">Opera Show</a>, a projection-mode style sheet technology (link demonstrates external link styling and window spawning)</li>
<li>Allows a single XHTML document to be turned into a PowerPoint-like slide show</li>
<li>Adding screen and print style sheets allows for multi-medium views of a single document</li>
<li>Highly efficient, but highly browser centric...</li>
</ul>

<div class="notes">
<ul>
<li>S5 and OperaShow diverged greatly in S5 1.1</li>
<li>S5 1.2 should (we hope) bring them into harmony once more</li>
</ul>
</div>

</li>


<li class="slide">
<h1>Incremental Display</h1>
<ul class="incremental show-first">
<li>Keep hitting/clicking "next" as long as it isn't the control link (&raquo;)</li>
<li>Bullet points are revealed one by one
<ul class="incremental">
<li>All based on class name of <code>inc</code></li>
<li>Lists can be classed to make items appear individually</li>
<li>Individual items can be classed as well to create "animations"; see <a href="http://boxofchocolates.ca/projects/s5-incremental-graphics/" rel="external">Derek Featherstone's example</a></li>
</ul>
</li>
<li>Let's try it again, but without the first bullet point being pre-highlighted...</li>
</ul>
</li>


<li class="slide">
<h1>Incremental Display II</h1>
<ul class="incremental">
<li>Keep hitting/clicking "next" as long as it isn't the control link (&raquo;)</li>
<li>Bullet points are revealed one by one
<ul>
<li>All based on class name of <code>incremental</code></li>
<li>Lists can be classed to make items appear individually</li>
<li>Individual items can be classed as well to create "animations"; see <a href="http://boxofchocolates.ca/projects/s5-incremental-graphics/" rel="external">Derek Featherstone's example</a></li>
</ul>
</li>
<li>Notice how the sub-list was part of the parent bullet point; that was done on purpose</li>
<li>Now to move on to other test slides!</li>
</ul>
</li>


<li class="slide">
<h1>PNG Alpha Tests</h1>
<div style="width: 400px; height: 150px; text-align: center; background: url(pix/bg-shade.png)">
<p>DIV with PNG background followed by foreground PNG</p>
<img src="ui/bg-shade.png" alt="" title="A translucent image" />
</div>
<div style="width: 100%; height: 150px; text-align: center; background: url(pix/bg-shade.png)">
<p>DIV with PNG background followed by foreground PNG</p>
<img src="ui/bg-shade.png" alt="" title="A translucent image" />
</div>
</li>


<li class="slide">
<h1>S5 Default File Structure</h1>
<p style="text-align: center;">
<img src="pix/s5filemap.png" alt="" title="At a Glance" />
</p>
</li>


<li class="slide">
<h1>S5 Themes</h1>
<p class="imgcon">
<img src="pix/S501.jpg" alt="" title="Default" />
<img src="pix/S502.jpg" alt="" title="I18N" />
<img src="pix/S503.jpg" alt="" title="Blue" />
<img src="pix/S504.jpg" alt="" title="Flower" />
(one way of presenting multiple graphics)
</p>
</li>


<li class="slide">
<h1>Incremental S5 Themes</h1>
<p class="imgcon">
<img src="pix/S501.jpg" alt="" title="Default" class="incremental" />
<img src="pix/S502.jpg" alt="" title="I18N" class="incremental" />
<img src="pix/S503.jpg" alt="" title="Blue" class="incremental" />
<img src="pix/S504.jpg" alt="" title="Flower" class="incremental" />
(one by one!)
</p>
</li>


<li class="slide">
<h1>Incremental Animation</h1>
<ul>
<li>A demonstration of just one of the many ways to accomplish simple animation-like effects <small>(using a diagram from <a href="http://gmpg.org/xfn/and/" rel="external">"XFN and..."</a>)</small></li>
</ul>
<p class="imgcon" id="anim">
<img src="pix/mememe01.png" id="me01" alt="" />
<img src="pix/mememe02.png" alt="" id="me02" class="incremental" />
<img src="pix/mememe03.png" alt="" id="me03" class="incremental" />
<img src="pix/mememe04.png" alt="" id="me04" class="incremental" />
<img src="pix/mememe05.png" alt="" id="me05" class="incremental" />
</p>
</li>


<li class="slide">
<h1>In Summary</h1>
<ul>
<li>With minimal scripting, we have recreated and improved upon a (currently) browser-specific technology, making it cross-browser in the process</li>
<li>The S5 format is OSF 1.0 compatible</li>
<li>S5 is a very flexible and lightweight slide show system available for anyone to use</li>
</ul>
</li>

<li class="slide">
    <h1>Crédits</h1>
    <ul>
        <li>La présentation est sous licence <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.fr">Creative Commons by-nc-sa 3.0</a></li>
        <li>Logo et couleurs : <a href="http://www.ruby-lang.org" rel="external">site Ruby Lang</a></li>
        <li>Images : Flickr</li>
        <li>Slideshow en HTML/CSS/JS : <a href="http://meyerweb.com/eric/tools/s5/" rel="external">S5</a> par Eric Meyer, version de Frédéric de Villamil sur <a href="git://github.com/fdv/s5.git" rel="external">GitHub</a></li>
        <li>Colorisation de code en Javascript avec <a href="http://shjs.sourceforge.net">SHJS</a></li>
    </ul>
</li>

</ol>

</body>
</html>
